{{- if and .Values.crowdsieve.enabled .Values.crowdsec.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "crowdsieve.fullname" . }}-capi-credentials
  labels:
    {{- include "crowdsieve.labels" . | nindent 4 }}
data:
  online_api_credentials.yaml: |
    url: {{ include "crowdsieve.internalUrl" . }}
    {{- if .Values.capiCredentials.existingSecret }}
    # Credentials managed via external secret
    {{- else if and .Values.capiCredentials.login .Values.capiCredentials.password }}
    # WARNING: These credentials are stored in plaintext in a ConfigMap.
    # Anyone with read access to this ConfigMap can see the login and password.
    # For production use, prefer capiCredentials.existingSecret to reference a Secret instead.
    login: {{ .Values.capiCredentials.login | quote }}
    password: {{ .Values.capiCredentials.password | quote }}
    {{- else }}
    # WARNING: No CAPI credentials configured
    # Set capiCredentials.login and capiCredentials.password in values
    # Or use capiCredentials.existingSecret to reference an existing secret
    {{- end }}
{{- end }}
